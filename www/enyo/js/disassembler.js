enyo.kind({name:"Disassembler",kind:"Scroller",tag:"div",classes:"ec_gui_background",style:"margin:0px;position: relative;",data:null,components:[{tag:"div",allowHtml:!0,name:"minimap",style:"width:200px; height:200px; position:fixed; top:0; right 0px",id:"minimap"},{tag:"div",allowHtml:!0,name:"panel",content:"<div id='main_panel' class='ui-layout-center ec_gui_background'><div id='center_panel'></div></div><div class='ui-layout-south' style='display: none;background-color:rgb(20,20,20);'><pre id='cmd_output' class='ui-layout-content'></pre><div><input id='command' type='text' value=''/></div></div>",style:"margin-right:5px;width:100%;height:100%"},{kind:enyo.Signals,onkeypress:"handleKeyPress"},{name:"menuPopup",kind:"onyx.Popup",floating:!0,onHide:"hideContextMenu",onShow:"showContextMenu",style:"padding: 0px;",style:"padding: 10px",components:[{name:"menu",kind:"onyx.MenuDecorator",onSelect:"itemSelected",components:[{content:"Show menu"},{kind:"onyx.Menu",name:"contextMenu",components:[{content:"rename",value:"rename"},{content:"comment",value:"comment"},{content:"switch view",value:"do_switchview"},{content:"random colors",value:"do_randomcolors"}]}]}]}],handlers:{ontap:"handleTap",onhold:"handleHold",ondblclick:"handleDoubleClick",onTransitionFinish:"handleTransitionFinish"},handleTransitionFinish:function(){"graph"==r2ui._dis.display&&r2ui._dis.minimap&&update_minimap()},itemSelected:function(a,b){if(b.originator.content){var c=b.originator.content;"rename"==c?this.do_rename(this.selected,b):"comment"==c?this.do_comment(this.selected_offset):"random colors"==c?do_randomcolors():"switch view"==c&&this.switch_view()}this.$.menuPopup.hide()},handleHold:function(a,b){if(this.handleTap(a,b),"string"==typeof b.target.className&&(b.target.className.indexOf(" addr ")>-1||b.target.className.indexOf(" faddr ")>-1)){var c=get_address_from_class(b.target);this.selected=b.target,this.selected_offset=c,rehighlight_iaddress(c),this.showContextMenu(b.pageY,b.pageX)}},showContextMenu:function(a,b){parseFloat(a)!=parseInt(a)||isNaN(a)||parseFloat(b)!=parseInt(b)||isNaN(b)||(this.$.menuPopup.addStyles("top:"+a+"px; left:"+b+"px;padding:0px;"),this.$.menuPopup.show(),this.$.menuPopup.children[0].children[0].hide(),this.$.menuPopup.children[0].children[1].show(),this.$.menuPopup.render())},hideContextMenu:function(a,b){},handleDoubleClick:function(a,b){b.target.className.indexOf(" addr ")>-1&&-1===b.target.className.indexOf("insaddr")&&(this.handleTap(a,b),this.goToAddress())},handleKeyPress:function(a,b){var c=b.keyCode||b.charCode||b.which||0,d=String.fromCharCode(c);if(!b.ctrlKey&&!b.metaKey&&"INPUT"!==$(b.target).prop("tagName")&&"TEXTAREA"!==$(b.target).prop("tagName")){if("?"===d&&r2ui.mp.show_popup()," "===d&&this.switch_view(),"h"===d){var e=r2ui.history_prev();void 0!==e&&null!==e&&r2ui.seek(e,!1)}if("l"===d){var e=r2ui.history_next();void 0!==e&&null!==e&&r2ui.seek(e,!1)}if("m"===d&&"graph"==r2ui._dis.display&&toggle_minimap(),"j"===d){var f=!1;if($(this.selected).hasClass("insaddr")){var g;if("flat"==this.display&&(g=$(this.selected).closest(".instructionbox").next().find(".insaddr")[0],$("#gbox .instructionbox").index($(this.selected).closest(".instructionbox")[0])>$("#gbox .instructionbox").length-10&&(f=!0)),"graph"==this.display){var g=$(this.selected).closest(".instruction").next().find(".insaddr")[0];void 0!==g&&null!==g||(g=$(this.selected).closest(".basicblock").next().find(".insaddr")[0])}var h=get_address_from_class(g);f?r2ui.seek(h,!1):(r2ui.history_push(h),this.selected=g,this.selected_offset=h),rehighlight_iaddress(h),scroll_to_address(h)}}if("k"===d){var f=!1;if($(this.selected).hasClass("insaddr")){var i;if("flat"==this.display&&(i=$(this.selected).closest(".instructionbox").prev().find(".insaddr")[0],$("#gbox .instructionbox").index($(this.selected).closest(".instructionbox")[0])<10&&(f=!0)),"graph"==this.display){var i=$(this.selected).closest(".instruction").prev().find(".insaddr")[0];void 0!==i&&null!==i||(i=$(this.selected).closest(".basicblock").prev().find(".insaddr").last()[0])}var h=get_address_from_class(i);f?r2ui.seek(h,!1):(r2ui.history_push(h),this.selected=i,this.selected_offset=h),rehighlight_iaddress(h),scroll_to_address(h)}}if("c"===d){var j=prompt("Function name?");null!==j&&r2.cmd("af "+j,function(){r2.update_flags(),r2ui.seek("$$",!1)})}if("d"===d&&r2.cmd("af-",function(){r2.update_flags(),r2ui.seek("$$",!1)}),"g"===d){var k=prompt("Go to");null!==k&&r2ui.opendis(k)}if(";"===d&&this.do_comment(this.selected_offset),"n"===d&&this.do_rename(this.selected,b),"R"===d&&do_randomcolors(),27===c)if(null!==this.renaming)this.renaming.innerHTML=this.renameOldValue,this.renaming=null;else{var e=r2ui.history_prev();void 0!==e&&null!==e&&r2ui.seek(e,!1)}13===c&&this.goToAddress()}},handleTap:function(a,b){if("string"==typeof b.target.className)if(b.target.className.indexOf(" addr ")>-1){var c=get_address_from_class(b.target);if(rehighlight_iaddress(c),this.selected=b.target,this.selected_offset=c,$(b.target).hasClass("insaddr")){r2ui.history_push(c);var d,e,f=!1,c=get_address_from_class(b.target);if("flat"==r2ui._dis.display&&(d=$(r2ui._dis.selected).closest(".instructionbox").next().find(".insaddr")[0],$("#gbox .instructionbox").index($(r2ui._dis.selected).closest(".instructionbox")[0])>$("#gbox .instructionbox").length-10&&(f=!0,c=get_address_from_class(d)),e=$(r2ui._dis.selected).closest(".instructionbox").prev().find(".insaddr")[0],$("#gbox .instructionbox").index($(r2ui._dis.selected).closest(".instructionbox")[0])<10&&(f=!0,c=get_address_from_class(e))),"graph"==r2ui._dis.display){var d=$(r2ui._dis.selected).closest(".instruction").next().find(".insaddr")[0];void 0!==d&&null!==d||(d=$(r2ui._dis.selected).closest(".basicblock").next().find(".insaddr")[0]);var e=$(r2ui._dis.selected).closest(".instruction").prev().find(".insaddr")[0];void 0!==e&&null!==e||(e=$(r2ui._dis.selected).closest(".basicblock").prev().find(".insaddr").last()[0])}f&&(r2ui.seek(c,!1),rehighlight_iaddress(c),scroll_to_address(c),document.getElementById("canvas").focus())}}else if($(b.target).hasClass("fvar")||$(b.target).hasClass("farg")){var g=null,c=get_address_from_class(b.target,"faddr");r2ui._dis.selected=b.target,r2ui._dis.selected_offset=c;var h=b.target.className.split(" ");for(var i in h){var j=h[i];0===j.indexOf("id_")&&(g=j.substring(3))}null!==g&&rehighlight_iaddress(g,"id")}},goToAddress:function(){if(null===this.renaming&&null!==this.selected&&this.selected.className.indexOf(" addr ")-1){var a=get_address_from_class(this.selected);if(this.selected.className.indexOf("ec_dataoffset")>-1)return void r2ui.openpage(a,2);void 0!==a&&null!==a&&(a=address_canonicalize(a),"flat"===this.display?r2ui.seek(a,!0):r2.cmdj("pdfj",function(b){if(null!==b&&void 0!==b){var c=b.ops,d=!1;for(var e in c)c[e].offset===parseInt(a,16)&&(d=!0);d?r2ui.seek_in_graph(a,!0):r2ui.seek(a,!0)}}))}},handleInputTextChange:function(){if(null!==this.renaming&&this.rbox.value.length>0){if($(this.selected).hasClass("insaddr")){var a=get_offset_flag(r2ui._dis.selected_offset),b="offsets";r2.cmdj("afij @ "+r2ui._dis.selected_offset,function(a){null!==a&&void 0!==a&&"0x"+a[0].offset.toString(16)===r2ui._dis.selected_offset&&(b="functions")}),rename(r2ui._dis.selected_offset,a,this.rbox.value,b)}else if($(this.selected).hasClass("faddr"))$(this.selected).hasClass("fvar")?r2.cmd("afvn "+r2ui._dis.renameOldValue+" "+r2ui._dis.rbox.value+" @ "+r2ui._dis.selected_offset,function(a){}):$(this.selected).hasClass("farg")&&r2.cmd("afan "+r2ui._dis.renameOldValue+" "+r2ui._dis.rbox.value+" @ "+r2ui._dis.selected_offset,function(a){});else{var a=r2ui._dis.renameOldValue;0===a.indexOf("0x")&&(a=""),rename(r2ui._dis.selected_offset,a,r2ui._dis.rbox.value,"*")}var c;"flat"==this.display&&(c=$(this.selected).closest(".instructionbox").find(".insaddr")[0]),"graph"==this.display&&(c=$(this.selected).closest(".instruction").find(".insaddr")[0]),this.renaming=null;var d=get_address_from_class(c);r2ui.seek(d,!1),scroll_to_address(d)}},min:0,max:0,block:512,base:"entry0",display:"flat",selected:null,renaming:null,renameOldValue:"",rbox:null,minimap:!0,console_history:[],console_history_idx:0,instructions:[],scrolling:!1,do_comment:function(a){var b=prompt("Comment");null!==b&&(r2.cmd("CC-  @ "+a+";CC "+b+" @ "+a),r2ui.seek(a,!1),scroll_to_address(a))},do_rename:function(a,b){if(null===this.renaming&&null!==this.selected&&this.selected.className.indexOf(" addr ")>-1){var c=get_address_from_class(this.selected);if(this.renaming=this.selected,this.renameOldValue=this.selected.innerHTML,this.rbox=document.createElement("input"),this.rbox.setAttribute("type","text"),this.rbox.setAttribute("id","rename"),this.rbox.setAttribute("style","border-width: 0;padding: 0;"),this.rbox.setAttribute("onChange","handleInputTextChange()"),this.selected.className.indexOf("insaddr")>-1){var d=get_offset_flag(c);this.rbox.setAttribute("value",d),this.rbox.setSelectionRange(d.length,d.length)}else this.rbox.setAttribute("value",this.renameOldValue),this.rbox.setSelectionRange(this.renameOldValue.length,this.renameOldValue.length);this.renaming.innerHTML="",this.renaming.appendChild(this.rbox),setTimeout("r2ui._dis.rbox.focus();",200)}else if(null===this.renaming&&null!==a&&$(a).hasClass("faddr")){var c=get_address_from_class(a,"faddr");this.selected=a,this.selected_offset=c,this.renaming=a,this.renameOldValue=a.innerText,this.rbox=document.createElement("input"),this.rbox.setAttribute("type","text"),this.rbox.setAttribute("id","rename"),this.rbox.setAttribute("style","border-width: 0;padding: 0;"),this.rbox.setAttribute("onChange","handleInputTextChange()"),this.rbox.setAttribute("value",this.renameOldValue),this.rbox.setSelectionRange(this.renameOldValue.length,this.renameOldValue.length),this.renaming.innerHTML="",this.renaming.appendChild(r2ui._dis.rbox),setTimeout("r2ui._dis.rbox.focus();",200)}},switch_view:function(){"flat"===this.display?this.display_graph():this.display_flat();var a=r2ui.history_last();void 0!==a&&null!==a&&r2ui.seek(a,!1)},display_graph:function(){this.display="graph",$("#main_panel").removeClass("ec_gui_background"),$("#main_panel").addClass("ec_gui_alt_background")},display_flat:function(){this.display="flat",$("#main_panel.ui-layout-pane").removeClass("ec_gui_alt_background"),$("#main_panel.ui-layout-pane").addClass("ec_gui_background")},seek:function(a,b){var c=!1;"graph"===this.display&&(this.$.minimap.show(),$("#center_panel").html(""),r2.cmd("agj "+a,function(a){$("#center_panel").html("<div id='center_panel' style='width:100%;height:100%;overflow: auto;'><div id='canvas' class='canvas enyo-selectable ec_gui_background'></div></div>"),render_graph(a)===!1&&(c=!0)})),c&&this.display_flat(),"flat"===this.display&&($("#main_panel").scroll(on_scroll),this.$.minimap.hide(),this.min=this.max=0,r2.get_disasm_before_after(a,-100,100,function(a){$("#center_panel").html("<div id='canvas' class='canvas enyo-selectable ec_gui_background'></div>"),r2ui._dis.instructions=a,render_instructions(r2ui._dis.instructions)})),this.selected=get_element_by_address(a),this.selected_offset=a,rehighlight_iaddress(a),void 0!==b&&b!==!0||scroll_to_address(a)},create:function(){this.inherited(arguments),this.base="entry0",r2ui._dis=this,r2.update_flags(),r2.analAll(),r2.load_mmap(),r2ui.load_colors()},resizeHandler:function(){this.inherited(arguments),"graph"==r2ui._dis.display&&r2ui._dis.minimap&&update_minimap()},rendered:function(){this.inherited(arguments),myLayout=$("#radareApp_mp_panels_pageDisassembler_panel").layout({south__size:200}),this.display_flat(),r2ui.seek(this.base,!0);var a=this.console_history,b=this.console_history_idx;$("#command").keypress(function(c){var d=c.keyCode||c.charCode||c.which||0;if(13===d){var e=c.target.value.trim(),f=""==e;a[a.length]=e,b+=1,""!=e&&(r2.cmd(inColor(e),function(a){var b=$("#cmd_output").text();$("#cmd_output").html(b+"\n> "+e+"\n"+a),$("#cmd_output").scrollTo($("#cmd_output")[0].scrollHeight)}),0===e.indexOf("s ")&&r2ui.history_push(r2ui._dis.selected_offset)),c.target.value="",f&&(r2.load_settings(),r2ui.load_colors(),r2ui.seek("$$",!1),scroll_to_element(r2ui._dis.selected))}}),$("#command").keydown(function(c){var d=c.keyCode||c.charCode||c.which||0;40===d&&(b++,b>a.length-1&&(b=a.length),c.target.value=void 0===a[b]?"":a[b]),38===d&&(b--,0>b&&(b=0),c.target.value=void 0===a[b]?"":a[b])})}});